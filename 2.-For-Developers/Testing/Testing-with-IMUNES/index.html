<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <link rel="shortcut icon" href="../../../img/favicon.ico">

    <title></title>

    <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../../css/base.css" rel="stylesheet">
    <link href="../../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">


    <link href="../../../css/golem_style.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="../../..">Golem Wiki</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">1. Installation <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../1.-Installation/Installation/">Installation - General Guide</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">MacOS</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../1.-Installation/MacOS/Installation-from-source-on-macOS/">Mac - install from source instructions</a>
</li>

        
            
<li >
    <a href="../../../1.-Installation/MacOS/Installation-on-Mac/">Mac - install instructions</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Ubuntu</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../1.-Installation/Ubuntu/Installation-from-source-on-Ubuntu/">Ubuntu - install from source instructions</a>
</li>

        
            
<li >
    <a href="../../../1.-Installation/Ubuntu/Installation-on-Ubuntu/">Ubuntu - install instructions</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Windows</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../1.-Installation/Windows/Installation-Packaging-Win/">Windows - Installation Packaging</a>
</li>

        
            
<li >
    <a href="../../../1.-Installation/Windows/Installation-from-source-on-Windows/">Windows - install from source instructions</a>
</li>

        
            
<li >
    <a href="../../../1.-Installation/Windows/Installation-on-Windows/">Windows - install instructions</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">2. For Developers <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../Command-Line/">Using the command line interface</a>
</li>

                        
                            
<li >
    <a href="../../Computing-Tasks-in-Docker/">Computing Tasks in Docker</a>
</li>

                        
                            
<li >
    <a href="../../Creating-a-subnet-of-nodes/">Creating a subnet of nodes</a>
</li>

                        
                            
<li >
    <a href="../../Development/">FAQ for developers</a>
</li>

                        
                            
<li >
    <a href="../../Logging/">Logging</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Testing</a>
    <ul class="dropdown-menu">
        
            
<li class="active">
    <a href="./">Testing with IMUNES</a>
</li>

        
            
<li >
    <a href="../Testing/">Testing</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">3. FAQ <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../3.-FAQ/Common-problems/">Common problems</a>
</li>

                        
                            
<li >
    <a href="../../../3.-FAQ/FAQ/">FAQ</a>
</li>

                        
                            
<li >
    <a href="../../../3.-FAQ/Roadmap/">Roadmap</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Obsolete</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../3.-FAQ/Obsolete/Installing-Golem-on-Arch-Linux-unofficial/">Installing Golem on Arch Linux unofficial</a>
</li>

        
            
<li >
    <a href="../../../3.-FAQ/Obsolete/Testing-old-GUI/">Testing old GUI</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">UseCases</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../../3.-FAQ/UseCases/Blender/">Blender</a>
</li>

        
            
<li >
    <a href="../../../3.-FAQ/UseCases/LuxRender/">LuxRender</a>
</li>

        
            
<li >
    <a href="../../../3.-FAQ/UseCases/Use-cases/">Use cases</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fa fa-search"></i> Search
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="../../Logging/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../Testing/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/golemfactory/golem/"><i class="fa fa-github"></i> GitHub</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#testing-with-imunes">Testing with IMUNES</a></li>
            <li class="second-level"><a href="#prerequisites">Prerequisites</a></li>
                
                <li class="third-level"><a href="#docker">Docker</a></li>
                <li class="third-level"><a href="#docker-images">Docker images</a></li>
                <li class="third-level"><a href="#imunes-imapp-version">IMUNES (imapp version)</a></li>
            <li class="second-level"><a href="#running-tests-with-the-imunespy-script">Running tests with the imunes.py script</a></li>
                
                <li class="third-level"><a href="#the-test-task">The test task</a></li>
                <li class="third-level"><a href="#log-files">Log files</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="testing-with-imunes">Testing with IMUNES</h1>
<h2 id="prerequisites">Prerequisites</h2>
<h3 id="docker">Docker</h3>
<p>Nodes simulated by IMUNES are run as docker containers, so you need to install docker. 
These instructions were tested with version 1.9.1 of docker. Docker installation instructions (for Ubuntu) are [[here|https://docs.docker.com/engine/installation/ubuntulinux/]]</p>
<h3 id="docker-images">Docker images</h3>
<p>The next step is to build the docker image that will run at the simulated nodes. There's a script that performs that step, using Dockerfiles in <code>tests/imunes</code>:</p>
<div class="codehilite"><pre><span></span>$ <span class="nb">cd</span> <span class="nv">$GOLEM</span>
$ tests/imunes/build-images.sh
</pre></div>


<p><em>Note</em> This script should be run on "clean" repository, this mean there should be no files added by user, especially files without read privileges.</p>
<p>Note that this script has to be run from the main <code>$GOLEM</code> dir.
The script uses two docker files from <code>$GOLEM/tests/imunes</code>:
<em> <code>Dockerfile.blender</code> is used to build the image <code>imapp/blender</code>; this is essentially the docker file for <code>ikester/blender</code>, but based on (<code>FROM</code>) <code>imunes/vroot</code> instead of <code>ubuntu:trusty</code>. 
</em> <code>Dockerfile.gnr</code> is used to build the final image <code>imapp/gnr</code>, based on <code>imapp/blender</code>. </p>
<p>If everything up to this point went well, the command <code>docker images</code> should list <code>imunes/vroot</code>, <code>imapp/blender</code> and <code>imapp/gnr</code>.</p>
<h3 id="imunes-imapp-version">IMUNES (imapp version)</h3>
<p>You'll need the imapp version of IMUNES which differs slightly from the original:</p>
<div class="codehilite"><pre><span></span>$ git clone git@github.com:imapp-pl/imunes.git
</pre></div>


<p>To install IMUNES (by default to <code>/usr/local/bin</code> and <code>/usr/local/lib/imunes</code>, this can probably be changed by setting the <code>PREFIX</code> var in <code>imunnes/GNUmakefile</code> but I haven't tested that) invoke:</p>
<div class="codehilite"><pre><span></span>$ <span class="nb">cd</span> imunes<span class="p">;</span> sudo make install all
</pre></div>


<p>IMUNES projects can be displayed and edited in IMUNES GUI as follows:</p>
<div class="codehilite"><pre><span></span>$ imunes <span class="nv">$GOLEM</span>/tests/imunes/local.imn
</pre></div>


<p>Starting, topping and attaching to running simulations requires root privileges. The following command starts the simulation in the background:</p>
<div class="codehilite"><pre><span></span>$ sudo imunes -b <span class="nv">$GOLEM</span>/tests/imunes/local.imn
Creating nodes...
<span class="m">100</span>.0%                                          
Creating links...
<span class="m">100</span>.0%                                          
Configuring nodes...
<span class="m">100</span>.0%                                          
Starting services...
Network topology instantiated in <span class="m">2</span>.374 seconds <span class="o">(</span><span class="m">4</span> nodes and <span class="m">3</span> links<span class="o">)</span>.
Experiment <span class="nv">ID</span> <span class="o">=</span> i590c
</pre></div>


<p>You may now attach to the running simulation by starting IMUNES GUI (<code>sudo imunes</code>) and choosing <code>Experiment-&gt;Attach to experiment</code> from the menu. Once attached, GUI can terminate the experiment (<code>Experiment-&gt;Terminate</code>). All running experiments can also be quickly terminated by </p>
<div class="codehilite"><pre><span></span>$ sudo cleanupAll
</pre></div>


<h2 id="running-tests-with-the-imunespy-script">Running tests with the <code>imunes.py</code> script</h2>
<p>The default test scenario (and the only one supported so far) is to start an IMUNES simulation using a specified IMUNES project file (<code>.imn</code>), and run GNR (ie <code>python gnr/node.py</code>) at each simulated machine. One GNR instance starts with a single task. The script then waits until the task is computed in the simulated network. </p>
<p>This scenario is run by executing the script:</p>
<div class="codehilite"><pre><span></span>$ sudo python <span class="nv">$GOLEM</span>/tests/imunes/imunes.py network.imn task.json --requester pc1 --supernode host1 --seed host1
</pre></div>


<p>The meaning of the arguments is as follows:
<em> <code>network.imn</code> is the IMUNES network topology file; this is the only mandatory argument.
</em> <code>task.json</code> is the file with the task description; if this argument is not specified then Golem nodes will start but no task will be computed.
<em> <code>--requester pc1</code> indicates that the node called <code>pc1</code> in the IMUNES project will request task computation; this argument is mandatory iff the task is specified.
</em> <code>--supernode host1</code> means that the node called <code>host1</code> will act as a Golem supernode; multiple supernodes may be speficied (or none).
* <code>--seed host1</code> means that it will also be used as a seed, i.e. other nodes will connect to it at their startup; multiple seeds may be specified (or none).</p>
<p>This should open few terminal windows, one for each simulated machine, displaying logs of GNR nodes computing the specified task. After the task is completed the terminal windows are closed and the simulation is terminated.</p>
<p>Note that the script has to be run as <code>root</code>. This is required to start IMUNES.</p>
<h3 id="the-test-task">The test task</h3>
<p>The task to run in the simulated network is read from a JSON file. The file is copied to <code>/opt/golem/test-task/task.json</code> at the the target machine before GNR nodes are started. Absolute paths in the task definition file, which are assumed to refer to files at the host machine, are adjusted so that they point to the files copied to the target machine. For example, the task file may specify <code>/home/finn/golem/task/scripts/blendertask.py</code> as the main program file. The script copies the program file to <code>/opt/golem/test-task/blendertask.py</code> and updates the path in the task file. Similarly, the scene file <code>/home/finn/blender/scene.blende</code> referenced to by the task file will be copied to <code>/opt/golem/test-task/scene.blend</code> and the path in the target task file will point to it.</p>
<p>Pickled task definitions may be converted to JSON files using the script at <code>scripts/pickle2json.py</code>.</p>
<h3 id="log-files">Log files</h3>
<p>Simulated GNR nodes write their log files to <code>/tmp/imunes/&lt;node-name&gt;/golem.log</code>, where <code>&lt;node-name&gt;</code> is the name of the simulated machine, for example <code>pc1</code> or <code>host2</code>. These names can be set in the IMUNES GUI. The logs are available even after the simulation ends but are overwritten when the test is restarted.</p></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../../../js/jquery-1.10.2.min.js"></script>
    <script src="../../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../../..';
    </script>
    <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
    <script src="../../../js/base.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../../../search/require.js"></script>
    <script src="../../../search/search.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
